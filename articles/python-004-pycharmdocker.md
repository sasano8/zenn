# PyCharm　＋　docker環境上で快適な開発をしたい


# 対象読者
- PyCharm + docker でWEB Application開発をしたい方（ライブラリ開発は、仮想環境を使用した方がシンプルでオススメです）
- Pycharm利用ユーザー（VS Codeの方がdockerの扱いは優れているようです。それでもPyCharmでdockerを使いたい方が対象です。）
- Dockerに関する教養がある程度ある方

# 筆者開発環境
筆者の開発環境は以下の通りです。（Windows Mac等の動作は検証していません。）

- ubuntu 20.04
- PyCharm x.x.x
- fastapi
- pytest

# 解決したい問題
PyCharmでは、dockerを利用した開発をサポートしていますが、以下のような不憫な点がいくつかあります。

- docker環境上に追加されたpackageを自動認識できない（dockerイメージの再ビルドが必要。VS Codeでは再ビルドは必要ないようです。）
- docker環境上でファイルを追加すると、ホスト上と異なるユーザーでファイルが作成され、ホスト上で権限が欠落する
- デバッグやpytest実行時、pycharmがdockerイメージを再起動するため起動時間がストレスになる

本記事では、上記のような不憫な点を解決できるように努めています。

# 解決していない問題

## docker環境上で追加されたpackageを自動認識できない
dockerコンテナ内でパッケージを追加しても、PyCharmはpackageを自動認識してくれません。
面倒ですが、dockerイメージを再ビルドしてください。

ホスト上のpythonの仮想環境を参照し、dockerコンテナのディレクトリと同期すれば何とかなりそうですが、今回は見送りしました。

# 手順
- dockerイメージ作成・権限設定
- プロジェクトインタープリタの設定
- プロジェクトとdocker環境上のファイル同期
- サンプルアプリケーションの作成
- ホットリロードでサンプルアプリケーションを起動
- ブレークポイントの利用
- pytestの実行
- コンテナへの入り方

